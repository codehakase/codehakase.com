<!DOCTYPE html>
<html lang="en-us">
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>Building Small Containers for Kubernetes | Francis Sunday</title>
  
  <meta name="description" content="This article will show you how you can build small containers to make your Kubernetes deployments faster and more secure.">
  
  
  <meta property="og:title" content="Building Small Containers for Kubernetes | Francis Sunday"/>
  <meta property="og:description" content="This article will show you how you can build small containers to make your Kubernetes deployments faster and more secure.">
  <meta property="og:type" content="article"/>
  <meta property="og:url" content="https://codehakase.com/blog/2018-01-12-building-small-containers-for-kubernetes/"/>
  
  
  <meta name="twitter:title" content="Building Small Containers for Kubernetes | Francis Sunday"/>
  <meta name="twitter:description" content="This article will show you how you can build small containers to make your Kubernetes deployments faster and more secure.">
  
  <meta name="twitter:creator" property="twitter:creator" content="@codehakase"/>
  
  
  
  <link href="https://fonts.googleapis.com/css?family=Roboto|Anonymous+Pro" rel="stylesheet">
  <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
  <link rel="stylesheet" href="https://codehakase.com/css/main.css">
  
  <style>
    body {
      font-family: "Anonymous Pro", monospace;
      font-size: 1.1em;
      line-height: 2;
    }
  </style>
  
  
  </head> 
  <body class="font-mono">
    <div class="max-w-3xl mx-auto p-4">
      <header class="flex flex-col md:flex-row justify-between items-center py-8">
  <div>
    <h1 class="text-4xl md:text-5xl font-bold">
      <a href="https://codehakase.com/">Francis Sunday</a>
    </h1>
  </div>
  
  <nav class="mt-4 md:mt-0">
    <ul class="flex space-x-4 text-base">
      <li>
        <a href="/" class="underline font-bold">/home</a>
      </li>
      <li>
        <a href="/blog/" class="underline font-bold">/posts</a>
      </li>
      <li>
        <a href="/archive/" class="underline font-bold">/archive</a>
      </li>
      <li>
        <a href="/tags/" class="underline font-bold">/tags</a>
      </li>
      <li>
        <a href="/2025" class="underline font-bold">/2025</a>
      </li>
    </ul>
  </nav>
</header> 
      
      <main>
        
<article class="mb-8">
  <header class="mb-8">
    <h1 class="text-3xl font-bold mb-2">Building Small Containers for Kubernetes</h1>
    <div class="text-sm">December 1, 2018</div>
  </header>

  

  <div class="prose max-w-none content-body">
    <p>The first step to deploying any app to <a href="https://kubernetes.io">Kubernetes</a>, is to bundle the app in a
container. There are several official, and community-backed container images for
various languages and distros, and most of these containers can be really large,
or sometimes contain overheads your app may never need/use.</p>
<p>Thanks to <a href="https://docker.io">Docker</a>, you can easily create container images in
a few steps; specify a base image, add your app-specific changes, and build your
container.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dockerfile" data-lang="dockerfile"><span style="display:flex;"><span><span style="font-weight:bold">FROM</span><span style="font-style:italic"> golang:alpine</span><span style="">
</span></span></span><span style="display:flex;"><span><span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span><span style="font-weight:bold">WORKDIR</span><span style="font-style:italic"> /app</span><span style="">
</span></span></span><span style="display:flex;"><span><span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span><span style="font-weight:bold">ADD</span> . /app<span style="">
</span></span></span><span style="display:flex;"><span><span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span><span style="font-weight:bold">EXPOSE</span><span style="font-style:italic"> 8080</span><span style="">
</span></span></span><span style="display:flex;"><span><span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span><span style="font-weight:bold">ENTRYPOINT</span> [<span style="font-style:italic">&#34;/app/run&#34;</span>]<span style="">
</span></span></span></code></pre></div><p>We specified a base image (Linux alpine in this case), set the working directory
to be used in the container, exposed a network port, and an entry point, which
will start the app in the container. With the Dockerfile set, we can build the
container.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker build myapp .
</span></span></code></pre></div><p>While the above process is pretty straight forward, there are some issues
to put into consideration. Using the default images can lead to large container
images, security vulnerabilities, and memory overheads.</p>
<h4 id="lets-flesh-out-a-sample-app">Let&rsquo;s flesh out a sample app</h4>
<p>We&rsquo;ll write a simple app in Go, that exposes a single HTTP route that returns a
string when hit. We will build a Docker image from it.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="font-weight:bold">package</span> main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">import</span> (
</span></span><span style="display:flex;"><span>	<span style="font-style:italic">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="font-style:italic">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="font-style:italic">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="font-style:italic">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">func</span> main() {
</span></span><span style="display:flex;"><span>	r := http.NewServeMux()
</span></span><span style="display:flex;"><span>	r.HandleFunc(<span style="font-style:italic">&#34;/api/&#34;</span>, <span style="font-weight:bold">func</span>(w http.ResponseWriter, r *http.Request) {
</span></span><span style="display:flex;"><span>		fmt.Fprintf(w, <span style="font-style:italic">&#34;Hello From Go!&#34;</span>)
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>	s := &amp;http.Server{
</span></span><span style="display:flex;"><span>		Addr:        <span style="font-style:italic">&#34;:8080&#34;</span>,
</span></span><span style="display:flex;"><span>		Handler:     r,
</span></span><span style="display:flex;"><span>		ReadTimeout: 10 * time.Second,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	fmt.Println(<span style="font-style:italic">&#34;Starting server on port 8080&#34;</span>)
</span></span><span style="display:flex;"><span>	log.Fatal(s.ListenAndServe())
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Let&rsquo;s build the Docker image with our app. First, we need to create a Dockerfile.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-docker" data-lang="docker"><span style="display:flex;"><span><span style="font-weight:bold">FROM</span><span style="font-style:italic"> golang:latest</span><span style="">
</span></span></span><span style="display:flex;"><span><span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span><span style="font-weight:bold">RUN</span> mkdir /app<span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span><span style="font-weight:bold">ADD</span> . /app/<span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span><span style="font-weight:bold">WORKDIR</span><span style="font-style:italic"> /app</span><span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span><span style="font-weight:bold">RUN</span> go build -o myapp .<span style="">
</span></span></span><span style="display:flex;"><span><span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span><span style="font-weight:bold">CMD</span> [<span style="font-style:italic">&#34;/app/myapp&#34;</span>]<span style="">
</span></span></span></code></pre></div><p>Build the image.</p>
<blockquote>
<p>PS: Replace tag with anything of choice: <!-- raw HTML omitted -->/appname</p></blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker build -t codehakase/goapp .
</span></span></code></pre></div><p>That&rsquo;s it! We just Dockerized a simple Go app. Let&rsquo;s take a look at the image we
just built.
<img src="https://res.cloudinary.com/hakase-labs/image/upload/v1543632543/Screen_Shot_2018-12-01_at_3.47.19_AM_wgpi3m.png" alt="docker images list"></p>
<p>For a simple Go app, the image is over 700 megabytes. The Go binary itself is
probably a few megabytes in size, and the additional overhead is wasted space,
and can also be a hiding place for bugs and security vulnerabilities.</p>
<p>What is taking up so much space? In this scenario, the container needs Go
installed, along with all the dependencies Go relies on, and all of this sits on
top of a Debian or Linux distro.</p>
<p>There are two ways to reduce container image sizes, actually three of which the
third is more often used in the Go community:</p>
<ol>
<li>Using Small Base Images</li>
<li>The Builder Pattern</li>
<li>Using Empty Images</li>
</ol>
<p>Using small base images are the easiest way to reduce container image size. The
stack/language in use probably provides an official image that&rsquo;s much smaller
than the default image.</p>
<p>Let&rsquo;s update the Dockerfile to use a small base image. We&rsquo;re going to use
<code>golang:alpine</code> in this case.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-docker" data-lang="docker"><span style="display:flex;"><span><span style="font-weight:bold">FROM</span><span style="font-style:italic"> golang:alpine</span><span style="">
</span></span></span><span style="display:flex;"><span><span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span><span style="font-weight:bold">RUN</span> mkdir /app<span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span><span style="font-weight:bold">ADD</span> . /app/<span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span><span style="font-weight:bold">WORKDIR</span><span style="font-style:italic"> /app</span><span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span><span style="font-weight:bold">RUN</span> go build -o myapp .<span style="">
</span></span></span><span style="display:flex;"><span><span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span><span style="font-weight:bold">CMD</span> [<span style="font-style:italic">&#34;/app/myapp&#34;</span>]<span style="">
</span></span></span></code></pre></div><p>Rebuild image.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker build -t codehakase/goapp .
</span></span></code></pre></div><p>With the update to the Dockerfile, our image is now smaller compared to the
previous image.
<img src="https://res.cloudinary.com/hakase-labs/image/upload/v1543633738/Screen_Shot_2018-12-01_at_4.07.28_AM_wm920i.png" alt="using small base images"></p>
<p>This image size if still quite large, and we can even go smaller using the
Builder Pattern. Since we&rsquo;re using a compiled language (Go) in this example, in
the builder pattern, we should note that compiled languages often requires tools
that are not necessarily needed to run the code. These tools are mostly for
building and compiling to a binary. With the builder pattern, we can remove
these tools in the final container.</p>
<p>To use the Builder pattern in our existing example, we&rsquo;ll compile our code in a
container, and then use the compiled code to package the final container, without
all the required tools.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-docker" data-lang="docker"><span style="display:flex;"><span><span style="font-weight:bold">FROM</span><span style="font-style:italic"> golang:alpine AS main-env</span><span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span><span style="font-weight:bold">RUN</span> mkdir /app<span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span><span style="font-weight:bold">ADD</span> . /app/<span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span><span style="font-weight:bold">WORKDIR</span><span style="font-style:italic"> /app</span><span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span><span style="font-weight:bold">RUN</span> cd /app &amp;&amp; go build -o myapp<span style="">
</span></span></span><span style="display:flex;"><span><span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span><span style="font-weight:bold">FROM</span><span style="font-style:italic"> alpine</span><span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span><span style="font-weight:bold">WORKDIR</span><span style="font-style:italic"> /app</span><span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span><span style="font-weight:bold">COPY</span> --from=main-env /app/myapp /app<span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span><span style="font-weight:bold">EXPOSE</span><span style="font-style:italic"> 8080</span><span style="">
</span></span></span><span style="display:flex;"><span><span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span><span style="font-weight:bold">ENTRYPOINT</span> ./myapp<span style="">
</span></span></span></code></pre></div><p>We updated the Dockerfile to use the builder pattern. First, it builds and
compiles the app in the <code>alpine</code> container and name the step <code>main-env</code>, and
then copies the binary from the previous step to the new container.</p>
<p>Rebuild the multistage Dockerfile.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker build -t codehakase/goapp .
</span></span></code></pre></div><p>The result of the build is a new container which is just a little over 10
megabytes.
<img src="https://res.cloudinary.com/hakase-labs/image/upload/v1543634782/Screen_Shot_2018-12-01_at_4.24.48_AM_c6fnis.png" alt="builder pattern"></p>
<p>Remember the first image we built that was over 700 megabytes? We&rsquo;ve been able
to cut that down to 10.7 megabytes using the builder pattern.</p>
<p>We can still reduce this number a bit, by making use of scratch (empty)
images. What&rsquo;s a scratch image? It&rsquo;s a special docker image that&rsquo;s empty. To use
this, we need to first build our app outside the docker environment and add the
compiled binary to the container.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ go build -o myapp .
</span></span></code></pre></div><p>We&rsquo;ll update the Dockerfile to add the binary to a scratch image.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-docker" data-lang="docker"><span style="display:flex;"><span><span style="font-weight:bold">FROM</span><span style="font-style:italic"> scratch</span><span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span><span style="font-weight:bold">ADD</span> myapp /<span style="">
</span></span></span><span style="display:flex;"><span><span style=""></span><span style="font-weight:bold">CMD</span> [<span style="font-style:italic">&#34;/myapp&#34;</span>]<span style="">
</span></span></span></code></pre></div><p>Let&rsquo;s build this image and see how large it turns out.
<img src="https://res.cloudinary.com/hakase-labs/image/upload/v1543635780/Screen_Shot_2018-12-01_at_4.36.33_AM_n2pane.png" alt="scratch image"></p>
<p>We got it down to 6.5 megabytes, cool! Let&rsquo;s try running our container to test
our app.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker run -it codehakase/goapp
</span></span></code></pre></div><p>You may get an error like this:
<img src="https://res.cloudinary.com/hakase-labs/image/upload/v1543635780/Screen_Shot_2018-12-01_at_4.40.08_AM_pvjj3k.png" alt=""></p>
<p>Reason for this error, is the Go binary is looking for libraries on the OS its
running on, since the scratch image is empty, there are no libraries to look in.
We need to modify the build command to statically compile our Go app:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ GO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o myapp .
</span></span></code></pre></div><p>Rebuild with <code>docker build -t codehakase/goapp</code>, and run the our container
again, forwarding the port on the container to our machine:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker run -it -p 8080:8080 codehakase/goapp
</span></span><span style="display:flex;"><span>  Starting server on port 8080
</span></span></code></pre></div><p>Navigate to <code>http://localhost:8080/api</code> to test the response from the app.</p>
<h3 id="conclusion">Conclusion</h3>
<p>The goal of this article was to explain how to reduce container sizes
specifically for Go apps. With smaller containers, you have more performance, as
building your containers say in a CI environment is going to be faster, pushing
your built images to a container registry will take less amount of time, and
most importantly pulling these containers to your distributed kubernetes
clusters will be faster, as smaller containers are less likely to delay a
deployment for a new cluster.</p>
<p>If you have any suggestions or comments, leave a comment below or ping
<a href="https://twitter.com/codehakase">@codehakase</a></p>

  </div>

  
  <div class="mt-8 pt-4 border-t border-gray-200">
    <h3 class="text-lg font-bold mb-2">Tags:</h3>
    <div class="flex flex-wrap">
      
        <a href="/tags/go" class="tag">go</a>
      
        <a href="/tags/docker" class="tag">docker</a>
      
        <a href="/tags/kubernetes" class="tag">kubernetes</a>
      
        <a href="/tags/golang" class="tag">golang</a>
      
    </div>
  </div>
  
</article>

      </main>
      
      <footer class="mt-8 pt-8">
  <div class="flex flex-wrap justify-between items-center">
    <div class="font-bold">
      <a class="underline" href="https://x.com/codehakase">/@codehakase</a>
      <a class="underline" href="https://linkedin.com/in/codehakase">/linkedin</a>
      <a class="underline" href="https://github.com/codehakase">/github</a>
    </div>
    <div class="mt-4 md:mt-0 text-sm">
      &copy; 2025 Francis Sunday
    </div>
  </div>
</footer> 
    </div>
  </body>
</html> 